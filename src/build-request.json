{
  "kind": "build_request",
  "title": "Seed container types and sizes master data with backend initialization and fix empty dropdowns",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-163",
      "text": "Implement backend initialization logic in backend/main.mo to automatically populate Container_Types stable storage with 10 default container types on first canister deployment: 1) Dry / General Purpose, 2) High Cube, 3) Refrigerated (Reefer), 4) Flat Rack, 5) Open Top, 6) Open Side, 7) Double Door / Tunnel, 8) Tank (ISO Tank), 9) Half Height, 10) Special / Modified, all with is_active=true and sequential IDs 1-10",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Insert default master data into Container_Types table: Dry / General Purpose, High Cube, Refrigerated (Reefer), Flat Rack, Open Top, Open Side, Double Door / Tunnel, Tank (ISO Tank), Half Height, Special / Modified"
        ]
      },
      "acceptanceCriteria": [
        "Container_Types stable storage contains exactly 10 pre-populated entries on initialization",
        "All container types have is_active=true",
        "IDs are sequential starting from 1",
        "Container type names match exactly as specified"
      ]
    },
    {
      "id": "REQ-164",
      "text": "Implement backend initialization logic in backend/main.mo to automatically populate Container_Sizes stable storage with 4 default container sizes on first canister deployment: 1) 20 ft Standard (length=20, width=8, height=8.5, is_high_cube=false), 2) 40 ft Standard (length=40, width=8, height=8.5, is_high_cube=false), 3) 40 ft High Cube (length=40, width=8, height=9.5, is_high_cube=true), 4) 45 ft High Cube (length=45, width=8, height=9.5, is_high_cube=true), all with is_active=true and sequential IDs 1-4",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Insert default master data into Container_Sizes table: 20 ft Standard → length=20, width=8, height=8.5, is_high_cube=false; 40 ft Standard → length=40, width=8, height=8.5, is_high_cube=false; 40 ft High Cube → length=40, width=8, height=9.5, is_high_cube=true; 45 ft High Cube → length=45, width=8, height=9.5, is_high_cube=true"
        ]
      },
      "acceptanceCriteria": [
        "Container_Sizes stable storage contains exactly 4 pre-populated entries on initialization",
        "All container sizes have is_active=true",
        "IDs are sequential starting from 1",
        "Dimensions match exactly as specified for each size",
        "is_high_cube flags are correctly set"
      ]
    },
    {
      "id": "REQ-165",
      "text": "Update backend migration logic in backend/migration.mo to apply default values to existing Daily_Production_Report entries that have NULL or missing container_type_id and container_size_id fields, setting container_type_id=2 (High Cube) and container_size_id=3 (40 ft High Cube) for backward compatibility with existing production data",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "For existing Daily_Production_Report rows: If container_type_id is NULL → assign 'High Cube', If container_size_id is NULL → assign '40 ft High Cube'"
        ]
      },
      "acceptanceCriteria": [
        "All existing Daily_Production_Report entries without container_type_id receive value 2",
        "All existing Daily_Production_Report entries without container_size_id receive value 3",
        "Migration logic runs automatically during canister upgrade",
        "No data loss occurs during migration"
      ]
    },
    {
      "id": "REQ-166",
      "text": "Verify DailyProductionReportForm component at frontend/src/components/DailyProductionReportForm.tsx correctly fetches container types using useContainerTypes hook and populates the Container Type dropdown with all active container types, displaying loading state while fetching and showing a fallback message if no container types are available",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Fetch active container types dynamically from Container_Types",
          "Ensure dropdown loads automatically on page load",
          "If no data found, show fallback message"
        ]
      },
      "acceptanceCriteria": [
        "Container Type dropdown displays all 10 container types when data is available",
        "Loading indicator shows while fetching container types",
        "Fallback message 'No container types available' displays if fetch returns empty",
        "Dropdown is populated automatically on component mount"
      ]
    },
    {
      "id": "REQ-167",
      "text": "Verify DailyProductionReportForm component at frontend/src/components/DailyProductionReportForm.tsx correctly fetches container sizes using useContainerSizes hook and populates the Container Size dropdown with all active container sizes, displaying loading state while fetching and showing a fallback message if no container sizes are available",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Fetch active container sizes dynamically from Container_Sizes",
          "Ensure dropdown loads automatically on page load",
          "If no data found, show fallback message"
        ]
      },
      "acceptanceCriteria": [
        "Container Size dropdown displays all 4 container sizes when data is available",
        "Loading indicator shows while fetching container sizes",
        "Fallback message 'No container sizes available' displays if fetch returns empty",
        "Dropdown is populated automatically on component mount"
      ]
    },
    {
      "id": "REQ-168",
      "text": "Ensure DailyProductionReportForm component at frontend/src/components/DailyProductionReportForm.tsx enforces required validation for both Container Type and Container Size dropdown fields, preventing form submission if either field is not selected and displaying appropriate validation error messages",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Make both fields required",
          "Show validation error if not selected"
        ]
      },
      "acceptanceCriteria": [
        "Form submission is blocked when Container Type is not selected",
        "Form submission is blocked when Container Size is not selected",
        "Validation error message displays for unselected Container Type field",
        "Validation error message displays for unselected Container Size field",
        "Form can submit successfully when both fields have valid selections"
      ]
    },
    {
      "id": "REQ-169",
      "text": "Verify useContainerTypes and useContainerSizes React Query hooks in frontend/src/hooks/useQueries.ts correctly call backend getContainerTypes() and getContainerSizes() queries with proper error handling, displaying toast notifications for API errors and implementing automatic retry logic for failed requests",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Implement proper API query for fetching dropdown data"
        ]
      },
      "acceptanceCriteria": [
        "useContainerTypes hook successfully fetches container types from backend",
        "useContainerSizes hook successfully fetches container sizes from backend",
        "Error toast notifications display when API calls fail",
        "Query hooks implement automatic retry on network failures",
        "Loading and error states are properly managed"
      ]
    }
  ],
  "constraints": [
    "All Motoko logic must remain in the single main actor file (backend/main.mo)",
    "Migration logic must be placed in backend/migration.mo",
    "Do not modify immutable frontend paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui",
    "Container type IDs must match: High Cube = 2, for backward compatibility migration",
    "Container size IDs must match: 40 ft High Cube = 3, for backward compatibility migration",
    "All backend queries must include requireAuthenticated() authorization check",
    "All backend mutations must include requireAdmin() authorization check"
  ],
  "nonGoals": [
    "Editing or deleting container types and sizes (master data is read-only)",
    "Adding UI for managing container types and sizes master data",
    "Changing existing frontend component structure beyond dropdown population fixes",
    "Modifying container type and size filtering logic already implemented",
    "Creating new pages or navigation items"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}